---
title: "Final Doc Research"
author: "Gabrielle Salamanca"
date: "June 1, 2023"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

### Libraries 

```{r library}
library(dplyr)
library(psych)
library(readr)
library(readxl)
library(SKAT)
library(tidyr)
```

### Dataset Reading

C19vj is the dataset holding all the vj genes and its values of covid patients, both recovered and active.

vj is the dataset holding all the vj genes and its values of healthy patients.

patients is the dataset that documents certain patients, both covid and healthy; symptom timing, both in days and weeks; and extra commentary.

```{r dataset}
C19vj <- read_csv("D:/Coding/R Storage/Summer TCR Project/TCR Datasets/dt.COVID_TCR.vjGene.p.csv",
                  show_col_types = FALSE)
vj <- read_csv("D:/Coding/R Storage/Summer TCR Project/TCR Datasets/dt.HD_TCR.vjGene.p.csv",
               show_col_types = FALSE)
patients <- read_excel("D:/Coding/R Storage/Summer TCR Project/TCR Datasets/dt.info_edited.xlsx")
```

### Summary of each dataset

Summary of C19vj:

```{r}
C19vj <- C19vj %>% 
  mutate_at(c('vjGene'), as.factor)
summary(C19vj)
```

Summary of vj:

```{r}
vj <- vj %>% 
  mutate_at(c('vjGene'), as.factor)
summary(vj)
```

Summary of patients as factor:

```{r}
patients <- patients %>% 
  mutate_at(c('Sample.ID', 'diseae.stage', 'days.from.first.symptoms', 
              'patient.ID', 'time', 'choose', '...7', 'comment'), 
            as.factor)
summary(patients)
```

### New dataset

Combined all three into one dataset called gene

```{r}
gene <- read_excel("D:/Coding/R Storage/Summer TCR Project/TCR Datasets/fullgenes.xlsx")
attach(gene)
```

C19vj and vj were first merged by the column vjGene, the dataset being named combine. Because of the multiple NAs in the value column, we replaced them with $1e^{-7}$. Then, we needed to rename to columns to match the Sample.ID column in patients. Next, we can use pivot_longer to log transform and standardize them. Finally, we can pivot_wider to make the dataset look like this:

| Patient | VJ1 | VJ2 |    Y    |   Y1   |
|:-------:|:---:|:---:|:-------:|:------:|
|  Pat 1  | ... | ... |    HD   |   HD   |
|  Pat 2  | ... | ... | Disease | Active |

There are NAs in terms of patients. For example, the healthy patients doesn't extend all the way to 39, it ended at 23. But they were kept in instead of removed, with the idea that it'll be done later down the line or the NAs will be replaced accordingly.

```{r}
genes <- genes %>% 
  mutate_at(c('patient.ID', 'Sample.ID', 'Y', 'Y1'), as.factor)
cat("Summary of genes: \n\n")
summary(genes)
```

Let's do a quick dimension check:

```{r dim}
cat("Dimensions of C19vj: \n")
dim(C19vj)
cat("\nDimensions of vj: \n")
dim(vj)
cat("\nDimensions of patients: \n")
dim(patients)
cat("\nDimensions of genes: \n")
dim(genes)
```

### SKAT

Now that the gene dataset has been prepped, we can start prepping for the work with the SKAT package. Now, we're going to separating the genes by v and j genes, so we need to make partial strings.

```{r string}
# v gene
stringv1 <- "TRBV10-1"
stringv2 <- "TRBV10-2"
stringv3 <- "TRBV10-3"
stringv4 <- "TRBV11-1"
stringv5 <- "TRBV11-2"
stringv6 <- "TRBV11-3"
stringv7 <- "TRBV12-1"
stringv8 <- "TRBV12-3"
stringv9 <- "TRBV12-4"
stringv10 <- "TRBV12-5"

stringv11 <- "TRBV13"
stringv12 <- "TRBV14"
stringv13 <- "TRBV15"
stringv14 <- "TRBV18"
stringv15 <- "TRBV19"
stringv16 <- "TRBV2"
stringv17 <- "TRBV20-1"
stringv18 <- "TRBV21-1"
stringv19 <- "TRBV23-1"
stringv20 <- "TRBV24-1"

stringv21 <- "TRBV25-1"
stringv22 <- "TRBV27"
stringv23 <- "TRBV28"
stringv24 <- "TRBV29-1"
stringv25 <- "TRBV3-2"
stringv26 <- "TRBV30"
stringv27 <- "TRBV4-1"
stringv28 <- "TRBV4-2"
stringv29 <- "TRBV4-3"
stringv30 <- "TRBV5-1"

stringv31 <- "TRBV5-3"
stringv32 <- "TRBV5-4"
stringv33 <- "TRBV5-5"
stringv34 <- "TRBV5-6"
stringv35 <- "TRBV5-7"
stringv36 <- "TRBV5-8"
stringv37 <- "TRBV6-1"
stringv38 <- "TRBV6-2"
stringv39 <- "TRBV6-3"
stringv40 <- "TRBV6-4"

stringv41 <- "TRBV6-5"
stringv42 <- "TRBV6-6"
stringv43 <- "TRBV6-7"
stringv44 <- "TRBV6-8"
stringv45 <- "TRBV6-9"
stringv46 <- "TRBV7-2"
stringv47 <- "TRBV7-3"
stringv48 <- "TRBV7-4"
stringv49 <- "TRBV7-5"
stringv50 <- "TRBV7-6"

# j gene
stringj1 <- "TRBJ1-1"
stringj2 <- "TRBJ1-2"
stringj3 <- "TRBJ1-3"
stringj4 <- "TRBJ1-4"
stringj5 <- "TRBJ1-5"
stringj6 <- "TRBJ1-6"
stringj7 <- "TRBJ2-1"
stringj8 <- "TRBJ2-2"
stringj9 <- "TRBJ2-3"
stringj10 <- "TRBJ2-4"

stringj11 <- "TRBJ2-5"
stringj12 <- "TRBJ2-6"
stringj13 <- "TRBJ2-7"
```


```{r, ref.label=knitr::all_labels(), echo = TRUE, eval = FALSE}
```
